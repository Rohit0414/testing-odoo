<?xml version="1.0" encoding="UTF-8"?>
<templates xml:space="preserve" owl="1">
  <t t-name="niyu_odoo_ai.NiyuAssistantPopup"> 
    <!-- Container for the floating assistant (button + popup) -->
    <div id="niyu_popup_container">
      <!-- Floating chat button (visible when popup is closed) -->
      <button t-if="!state.open" t-on-click="togglePopup" 
              id="niyu_toggle_button" class="niyu-toggle-btn" title="Ask Niyu AI">
        <i class="fa fa-comments"></i>
      </button>
      <!-- Popup chat window (visible when open) -->
      <div t-if="state.open" id="niyu_popup_window" class="niyu-popup-window">
        <!-- Popup header with title and close "X" -->
        <div class="niyu-popup-header">
          <span class="title">Niyu AI Assistant</span>
          <button class="close-btn" t-on-click="closePopup" title="Close">×</button>
        </div>
        <!-- Popup body with input, button, and response area -->
        <div class="niyu-popup-body">
          <div class="mb-2">
            <label class="form-label fw-semibold">Your Question:</label>
            <input type="text" t-ref="queryInput" class="form-control" 
                   placeholder="Type your question..."/>
          </div>
          <div class="d-grid mb-2">
            <button type="button" class="btn btn-primary" 
                    t-on-click="sendQuery" t-att-disabled="state.isLoading">
              <t t-if="state.isLoading">
                <span class="spinner-border spinner-border-sm me-1" role="status"></span>
                Asking...
              </t>
              <t t-else="state.isLoading">
                <i class="fa fa-magic me-1"></i> Ask
              </t>
            </button>
          </div>
          <!-- Response display area -->
          <div class="mt-3">
            <div t-if="state.responseIntro" class="mb-2 text-dark">
              <t t-esc="state.responseIntro"/>
            </div>
            <ol t-if="state.responseList and state.responseList.length" t-att-class="state.error ? 'text-danger' : 'text-dark'">
              <li t-foreach="state.responseList" t-as="item" t-key="item">
                <t t-esc="item"/>
              </li>
            </ol>
            <div t-if="state.responseOutro" class="mt-2 text-dark">
              <t t-esc="state.responseOutro"/>
            </div>
            <div t-if="!state.isLoading and !(state.responseIntro or (state.responseList and state.responseList.length) or state.responseOutro)" class="text-muted">
              <em>Response will appear here…</em>
            </div>
          </div>
        </div>
      </div>
    </div>
  </t>
</templates>
